!function(e){var t={};function o(r){if(t[r])return t[r].exports;var c=t[r]={i:r,l:!1,exports:{}};return e[r].call(c.exports,c,c.exports,o),c.l=!0,c.exports}o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)o.d(r,c,function(t){return e[t]}.bind(null,c));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";function r(e){const t=e.toString(16);return 1===t.length?"0"+t:t}function c(e,t,o){return"#"+r(e)+r(t)+r(o)}o.r(t);const n=[["00BCD4","FFEB3B","FFEB3B","00BCD4"],["FFEB3B","FFC107","FFC107","FFEB3B"],["FFEB3B","FFC107","FFC107","FFEB3B"],["00BCD4","FFEB3B","FFEB3B","00BCD4"]],l=(e,t,o)=>{if(t<0||o<0||t>=e.width||o>=e.height)return NaN;const r=e.data,c=4*(o*e.width+t);return(255&r[c+0])<<24|(255&r[c+1])<<16|(255&r[c+2])<<8|(255&r[c+3])<<0},u=(e,t,o)=>{if(t<0||o<0||t>=e.width||o>=e.height)return NaN;const r=e.data,n=4*(o*e.width+t);return"0x"+c(r[n],r[n+1],r[n+2]).substr(1)+"FF"},d=(e,t,o,r)=>{const c=4*(o*e.width+t),n=e.data;n[c+0]=r>>>24&255,n[c+1]=r>>>16&255,n[c+2]=r>>>8&255,n[c+3]=r>>>0&255},a=(e,t)=>{if(isNaN(e)||isNaN(t))return 1/0;const o=(e>>>24&255)-(t>>>24&255),r=(e>>>16&255)-(t>>>16&255),c=(e>>>8&255)-(t>>>8&255),n=(e>>>0&255)-(t>>>0&255);return o*o+r*r+c*c+n*n};function s(e,t,o){"remove"===e?document.querySelector(o).classList.remove(t):"add"===e&&document.querySelector(o).classList.add(t)}window.onload=()=>{const e=localStorage.getItem("currentCanvas"),t=document.getElementById("canvas"),o=t.getContext("2d"),r=128,i="0xff0000FF",f=document.getElementById("red_color"),m=document.getElementById("blue_color"),y=document.getElementById("prev_color");if(null===e)!function(){for(let e=0;e<n.length;e++)for(let t=0;t<n[0].length;t++)o.fillStyle="#"+n[e][t],o.fillRect(t*r,e*r,r,r)}();else{const t=e,r=new Image;r.src=t,r.onload=function(){o.drawImage(r,0,0)}}const g=document.getElementById("pencil"),b=document.getElementById("choose_color"),h=document.getElementById("paint_bucket"),p=document.getElementById("eraser"),v=[g,b,h,p];let F=g;F.classList.add("selected-tool"),v.forEach(e=>{e.addEventListener("click",()=>{document.querySelector(".selected-tool").classList.remove("selected-tool"),e.classList.add("selected-tool"),F=e.getAttribute("id")})});let k=i;document.querySelector(".current-color").style.background="#FF0000";let S="0x808080FF";document.querySelector(".prev-color").style.background="#808080";const E=document.getElementById("select_color");function B(e,t,c){if(!w)return;const n=Math.floor(e/r)*r,l=Math.floor(t/r)*r,u=o.getImageData(n,l,r,r);for(let e=0;e<4*r*r;e+=4)u.data[e]=c>>>24&255,u.data[e+1]=c>>>16&255,u.data[e+2]=c>>>8&255,u.data[e+3]=c>>>0&255;o.putImageData(u,n,l)}E.addEventListener("input",(function(){document.querySelector(".prev-color").style.background=document.querySelector(".current-color").style.background,document.querySelector(".current-color").style.background=E.value,S=k,k="0x"+E.value.substr(1)+"FF"}),!1),f.addEventListener("click",()=>{S=k,k=i,document.querySelector(".prev-color").style.background=document.querySelector(".current-color").style.background,document.querySelector(".current-color").style.background="#"+k.substr(2,String(k).length-4)}),m.addEventListener("click",()=>{S=k,k="0x0000FFFF",document.querySelector(".prev-color").style.background=document.querySelector(".current-color").style.background,document.querySelector(".current-color").style.background="#"+k.substr(2,String(k).length-4)}),y.addEventListener("click",()=>{let e=k;k=S,S=e,e=document.querySelector(".prev-color").style.background,document.querySelector(".prev-color").style.background=document.querySelector(".current-color").style.background,document.querySelector(".current-color").style.background=e});let w=!1,q=!1;t.addEventListener("mousemove",e=>{switch([L,_]=[e.offsetX,e.offsetY],F){case"pencil":case g:B(L,_,k);break;case"eraser":I(L,_);break;default:return}}),t.addEventListener("mousedown",e=>{switch([L,_]=[e.offsetX,e.offsetY],F){case"pencil":case g:w=!0,B(L,_,k);break;case"eraser":q=!0,I(L,_);break;default:return}});const I=(e,t)=>{q&&(o.fillStyle="rgba(255,255,255,1)",o.fillRect(Math.floor(e/r)*r,Math.floor(t/r)*r,r,r))};t.addEventListener("mouseup",()=>{w=!1,q=!1}),t.addEventListener("mouseout",()=>{w=!1,q=!1});let L=0,_=0;t.addEventListener("click",e=>{L=e.layerX,_=e.layerY,"paint_bucket"===F?function(e,t,o,r,c){let n,s,i,f,m,y,g;const b=e.getContext("2d"),h=b.getImageData(0,0,e.width,e.height);if(u(h,t,o)===r)return;const p=[];for(let t=0;t<e.width;t++)p[t]=[];const v=l(h,t,o);for(c*=c,f=[[t,o]],p[t][o]=!0;n=f.pop();)if(y=n[0],g=n[1],a(l(h,y,g),v)<=c){for(d(h,y,g,r),s=i=y;s>0&&a(l(h,s-1,g),v)<=c&&(--s,!p[s][g]);)d(h,s,g,r);for(;i<h.width-1&&a(l(h,i+1,g),v)<=c&&(++i,!p[i][g]);)d(h,i,g,r);for(y=s;y<=i;y++)g>0&&(m=l(h,y,g-1),a(m,v)<=c&&(p[y][g-1]||(f.push([y,g-1]),p[y][g-1]=!0))),g<e.height-1&&(m=l(h,y,g+1),a(m,v)<=c&&(p[y][g+1]||(f.push([y,g+1]),p[y][g+1]=!0)))}b.putImageData(h,0,0,0,0,e.width,e.height)}(t,L,_,k,1):"choose_color"===F&&function(e,t){const r=o.getImageData(e,t,1,1).data;S=k,k="0x"+c(r[0],r[1],r[2]).substr(1)+"FF",document.querySelector(".prev-color").style.background=document.querySelector(".current-color").style.background,document.querySelector(".current-color").style.background=c(r[0],r[1],r[2])}(L,_)}),document.addEventListener("keydown",(function(e){switch(e.keyCode){case 66:F="paint_bucket",s("remove","selected-tool",".selected-tool"),s("add","selected-tool","#paint_bucket");break;case 80:F="pencil",s("remove","selected-tool",".selected-tool"),s("add","selected-tool","#pencil");break;case 67:F="choose_color",s("remove","selected-tool",".selected-tool"),s("add","selected-tool","#choose_color");break;case 69:F="eraser",s("remove","selected-tool",".selected-tool"),s("add","selected-tool","#eraser")}})),o.clearRect(0,0,t.width,t.height),window.addEventListener("beforeunload",()=>{localStorage.setItem("currentCanvas",t.toDataURL())})}}]);